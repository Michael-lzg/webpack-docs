<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Loader | webpack从入门到精通</title>
    <meta name="description" content="讲解webpack相关知识点">
    
    
    <link rel="preload" href="/webpack-docs/assets/css/0.styles.d386d2e7.css" as="style"><link rel="preload" href="/webpack-docs/assets/js/app.d193fe94.js" as="script"><link rel="preload" href="/webpack-docs/assets/js/12.1b278652.js" as="script"><link rel="prefetch" href="/webpack-docs/assets/js/10.65749ef8.js"><link rel="prefetch" href="/webpack-docs/assets/js/11.49efa7cc.js"><link rel="prefetch" href="/webpack-docs/assets/js/13.b81fa354.js"><link rel="prefetch" href="/webpack-docs/assets/js/14.c8d9efba.js"><link rel="prefetch" href="/webpack-docs/assets/js/15.107aaab4.js"><link rel="prefetch" href="/webpack-docs/assets/js/16.db6d3797.js"><link rel="prefetch" href="/webpack-docs/assets/js/17.f8c3a1c5.js"><link rel="prefetch" href="/webpack-docs/assets/js/18.7914fb5e.js"><link rel="prefetch" href="/webpack-docs/assets/js/19.c0c37cca.js"><link rel="prefetch" href="/webpack-docs/assets/js/2.0782c440.js"><link rel="prefetch" href="/webpack-docs/assets/js/20.bb008680.js"><link rel="prefetch" href="/webpack-docs/assets/js/3.b3d60b1a.js"><link rel="prefetch" href="/webpack-docs/assets/js/4.c1dab2c8.js"><link rel="prefetch" href="/webpack-docs/assets/js/5.90536a28.js"><link rel="prefetch" href="/webpack-docs/assets/js/6.73f2010d.js"><link rel="prefetch" href="/webpack-docs/assets/js/7.be21827e.js"><link rel="prefetch" href="/webpack-docs/assets/js/8.eb6f9133.js"><link rel="prefetch" href="/webpack-docs/assets/js/9.13f17710.js">
    <link rel="stylesheet" href="/webpack-docs/assets/css/0.styles.d386d2e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/webpack-docs/" class="home-link router-link-active"><!----> <span class="site-name">webpack从入门到精通</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/webpack-docs/" class="nav-link">主页</a></div><div class="nav-item"><a href="/webpack-docs/page/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Michael-lzg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/user/5b52fd38f265da0f4c6fbd72/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/webpack-docs/" class="nav-link">主页</a></div><div class="nav-item"><a href="/webpack-docs/page/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Michael-lzg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/user/5b52fd38f265da0f4c6fbd72/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>webpack前世今生</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/webpack-docs/page/fonted/前端模块化.html" class="sidebar-link">前端模块化</a></li><li><a href="/webpack-docs/page/fonted/glup.html" class="sidebar-link">webpack 与 glup</a></li><li><a href="/webpack-docs/page/fonted/webpack4.0.html" class="sidebar-link">webpack 4.0</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>webpack基础篇</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/webpack-docs/page/base/entry.html" class="sidebar-link">entry和output</a></li><li><a href="/webpack-docs/page/base/loader.html" class="active sidebar-link">Loader</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/webpack-docs/page/base/plugin.html" class="sidebar-link">Plugin</a></li><li><a href="/webpack-docs/page/base/webpack-dev-derver.html" class="sidebar-link">webpack-dev-derver</a></li><li><a href="/webpack-docs/page/base/sourcemap.html" class="sidebar-link">sourceMap</a></li><li><a href="/webpack-docs/page/base/optimization.html" class="sidebar-link">optimization</a></li><li><a href="/webpack-docs/page/base/babel.html" class="sidebar-link">babel 指南</a></li><li><a href="/webpack-docs/page/base/hash.html" class="sidebar-link">文件 hash</a></li><li><a href="/webpack-docs/page/base/知识问答.html" class="sidebar-link">webpack 知识问答</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>webpack深入篇</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/webpack-docs/page/advanced/demo.html" class="sidebar-link">搭建一个项目</a></li><li><a href="/webpack-docs/page/advanced/优化打包.html" class="sidebar-link">打包优化</a></li><li><a href="/webpack-docs/page/advanced/webpack-chain.html" class="sidebar-link">webpack-chain</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="loader"><a href="#loader" aria-hidden="true" class="header-anchor">#</a> Loader</h1> <p><code>loader</code> 让 <code>webpack</code> 能够去处理那些非 <code>javaScript</code> 文件（<code>webpack</code> 自身只理解 <code>javaScript</code>）。<code>loader</code> 可以将所有类型的文件转换为 <code>webpack</code> 能够处理的有效模块，然后你就可以利用 <code>webpack</code> 的打包能力，对它们进行处理。</p> <h3 id="loader-的特点"><a href="#loader-的特点" aria-hidden="true" class="header-anchor">#</a> loader 的特点</h3> <ol><li><p>一个 Loader 的职责是单一的，只需要完成一种转换。</p></li> <li><p>一个 Loader 其实就是一个 Node.js 模块，这个模块需要导出一个函数</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> content <span class="token operator">&amp;&amp;</span> content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/kobe/gi</span><span class="token punctuation">,</span> <span class="token string">'Black Mamba'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>loader 总是从右到左地被调用。</li></ol> <p>函数组合通常有两种方式，一种是从左到右(类似 unix 的 pipe)，另外一种是从右到左(compose)。webpack 选择的是 compose 方式，从右到左依次执行 loader，每个 loader 是一个函数。</p> <p>webpack 里面的 compose 代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>fns</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fns<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">prevFn<span class="token punctuation">,</span> nextFn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token function">nextFn</span><span class="token punctuation">(</span><span class="token function">prevFn</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="loader-的配置"><a href="#loader-的配置" aria-hidden="true" class="header-anchor">#</a> loader 的配置</h3> <p>在配置文件中加入 module 这个配置项，它是一个对象，在这个对象里面配置相应的处理模块的规则。</p> <p>在 module 的选项里 有一个 rules 数组，rules 就是配置模块的读取和解析规则，通常就是用来配置 loader。数组里面的每一项都描述了如何处理对应的文件，配置一项 rules 时大致可以通过一项方式来完成：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 方法一</span>
<span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.jsx?$/</span><span class="token punctuation">,</span> <span class="token comment">//匹配规则</span>
  use<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span>
  <span class="token comment">// use: ['style-loader', 'css-loader'] 多个loader</span>
<span class="token punctuation">}</span>

<span class="token comment">// 方法二</span>
<span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.jsx?$/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token comment">//...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="常用的-loader"><a href="#常用的-loader" aria-hidden="true" class="header-anchor">#</a> 常用的 loader</h3> <h4 id="处理样式"><a href="#处理样式" aria-hidden="true" class="header-anchor">#</a> 处理样式</h4> <ul><li><code>css-loader</code>: 加载.css 文件，</li> <li><code>style-loader</code>:使用 style 标签将 <code>css-loader</code> 内部样式注入到我们的 html 页面</li> <li><code>less-loader, sass-loader</code>: 解析 css 预处理器</li> <li><code>postcss-loader</code> css 增加前缀</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span> <span class="token comment">// 正则匹配以.css结尾的文件</span>
    use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><ul><li><code>style-loader</code> 放在 <code>css-loader</code> 后面是因为 webpack 打包机制是按照数组从后往前的顺序将资源交个 loader 处理。</li> <li><code>postcss-loader</code> 要和<code>autoprefixer</code>一起使用。在项目根目录下新建 postcss.config.js 文件:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 引用autoprefixer模块</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="处理-js"><a href="#处理-js" aria-hidden="true" class="header-anchor">#</a> 处理 js</h4> <ul><li>让你能使用最新的 js 代码（ES6，ES7...）</li> <li>让你能使用基于 js 进行了拓展的语言，比如 React 的 JSX；</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
    exclude<span class="token punctuation">:</span> <span class="token string">'/node_modules/'</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        cacheDirectory<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        presets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'env'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> modules<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><ul><li><code>exclude</code>，排除了目录 <code>node_modules</code>，可不编译 <code>node_modules</code> 目录中的模块，提高打包速度；</li> <li><code>babel-loader</code>，转译 ES6+;</li> <li><code>@babel/core</code>，babel 编译器核心模块；</li> <li><code>@babel/preset-env</code>，预置器，根据用户配置的目标环境自动添加需要的插件和补丁来编译 ES6+；</li> <li><code>cacheDirectory</code>，缓存机制，这里设为 true，在重复打包未改变的模块时防止二次编译，提高打包速度，指向 <code>node_modules/.cache/babel-loader</code>；</li> <li><code>presets</code> 的 modules 设置为 false，意思是禁止让 <code>@babel/preset-env</code> 将模块语句转换，让 <code>ES6 Module</code> 语法给 webpack 处理，若是为 true，会将 <code>ES6 Module</code> 模块转化为 <code>CommonJS</code> 形式，这将会导致 <code>tree-shaking</code> 特性失效；</li></ul> <p>此外，babel-loader 还有如下优化写法：在项目根目录下新建.babelrc 文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="处理文件"><a href="#处理文件" aria-hidden="true" class="header-anchor">#</a> 处理文件</h4> <p>处理图片资源时，我们常用的两种 loader 是<code>file-loader</code>或者<code>url-loader</code>，两者的主要差异在于。<code>url-loader</code>可以设置图片大小限制，当图片超过限制时，其表现行为等同于<code>file-loader</code>，而当图片不超过限制时，则会将图片以<code>base64</code>的形式打包进 css 文件，以减少请求次数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.(png|jpe?g|gif|svg)(\?.*)?$/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    limit<span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">assetsPath</span><span class="token punctuation">(</span><span class="token string">'img/[name].[hash:7].[ext]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="压缩图片"><a href="#压缩图片" aria-hidden="true" class="header-anchor">#</a> 压缩图片</h4> <p>在项目中有些图片太大影响加载，我们用 image-webpack-loader 进行压缩。</p> <div class="language-js extra-class"><pre class="language-js"><code>rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.(png|jpg|svg|gif)$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          esModule<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          limit<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 限制只有小于1kb的图片才转为base64，例子图片为1.47kb,所以不会被转化</span>
          outputPath<span class="token punctuation">:</span> <span class="token string">'images'</span><span class="token punctuation">,</span> <span class="token comment">// 设置打包后图片存放的文件夹名称</span>
          name<span class="token punctuation">:</span> <span class="token string">'[name][hash:8].[ext]'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token string">'image-webpack-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 压缩 jpeg 的配置</span>
          mozjpeg<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            progressive<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            quality<span class="token punctuation">:</span> <span class="token number">65</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">// 使用 imagemin**-optipng 压缩 png，enable: false 为关闭</span>
          optipng<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            enabled<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">// // 使用 imagemin-pngquant 压缩 png</span>
          pngquant<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            quality<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.65</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            speed<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">// 压缩 gif 的配置</span>
          gifsicle<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            interlaced<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">// 开启 webp，会把 jpg 和 png 图片压缩为 webp 格式</span>
          webp<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            quality<span class="token punctuation">:</span> <span class="token number">75</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="处理-vue-文件"><a href="#处理-vue-文件" aria-hidden="true" class="header-anchor">#</a> 处理.vue 文件</h4> <p><code>vue-loader</code> 是 <code>webpack</code> 的加载器模块，它使我们可以用 <code>.vue</code> 文件格式编写单文件组件。单文件组件文件有三个部分，即模板、脚本和样式。 <code>vue-loader</code> 模块允许 <code>webpack</code> 使用单独的加载器模块（例如 <code>sass 或 scss 加载器</code>）提取和处理每个部分。该设置使我们可以使用 <code>.vue</code> 文件无缝编写程序。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.vue$/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'vue-loader'</span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> vueLoaderConfig
<span class="token punctuation">}</span>
</code></pre></div><h3 id="开发一个-loader"><a href="#开发一个-loader" aria-hidden="true" class="header-anchor">#</a> 开发一个 loader</h3> <p>需求：手写一个 <code>loader</code>，将 <code>'kobe'</code> 转换成 <code>'Black Mamba'</code>。当然大家可以根据自己的需求进行设计。这里只是讲解方法。</p> <h4 id="_1、编写-loader"><a href="#_1、编写-loader" aria-hidden="true" class="header-anchor">#</a> 1、编写 loader</h4> <p>在根目录下，新建目录 <code>kobe-loader</code> 作为我们编写 <code>loader</code> 的名称，执行 <code>npm init -y</code> 命令，新建一个模块化项目，然后新建 <code>index.js</code> 文件，相关源码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> content <span class="token operator">&amp;&amp;</span> content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/kobe/gi</span><span class="token punctuation">,</span> <span class="token string">'Black Mamba'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2、注册模块"><a href="#_2、注册模块" aria-hidden="true" class="header-anchor">#</a> 2、注册模块</h4> <p>正常我们安装的 <code>loader</code> 是从 <code>npm</code> 下载安装，但是我们可以在 <code>kobe-loader</code> 目录底下使用 <code>npm link</code> 做到在不发布模块的情况下，将本地的一个正在开发的模块的源码链接到项目的 <code>node_modules</code> 目录下，让项目可以直接使用本地的 <code>npm</code> 模块。</p> <div class="language- extra-class"><pre class="language-text"><code>npm link
</code></pre></div><p>然后在项目根目录执行以下命令，将注册到全局的本地 <code>npm</code> 模块链接到项目的 <code>node_modules</code> 下</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm link kobe-loader
</code></pre></div><p>注册成功后，我们可以在 <code>node_modules</code> 目录下能查找到对应的 <code>loader</code>。</p> <h4 id="_3、在-webpack-中配置-loader"><a href="#_3、在-webpack-中配置-loader" aria-hidden="true" class="header-anchor">#</a> 3、在 webpack 中配置 loader</h4> <p>在 <code>webpack.base.conf.js</code> 加上如下配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span><span class="token regex">/\.js/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'kobe-loader'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此时，我们在所有 js 文件下书写的 <code>'kobe'</code> 就全部替换成 <code>'Black Mamba'</code>了。</p> <h4 id="_4、配置参数"><a href="#_4、配置参数" aria-hidden="true" class="header-anchor">#</a> 4、配置参数</h4> <p>上面我们是写死的替换文案，假如我想通过配置项来改变，可以在 loader 中做以下调整</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// custom-loader/index.js</span>
<span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> content <span class="token operator">&amp;&amp;</span> content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/kobe/gi</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// webpack.base.conf.js</span>
<span class="token punctuation">{</span>
  test<span class="token punctuation">:</span><span class="token regex">/\.js/</span><span class="token punctuation">,</span>
  use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span> <span class="token string">'kobe-loader'</span><span class="token punctuation">,</span>
    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'kobe'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/webpack-docs/page/base/entry.html" class="prev">
          entry和output
        </a></span> <span class="next"><a href="/webpack-docs/page/base/plugin.html">
          Plugin
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/webpack-docs/assets/js/app.d193fe94.js" defer></script><script src="/webpack-docs/assets/js/12.1b278652.js" defer></script>
  </body>
</html>
