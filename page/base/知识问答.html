<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack 知识问答 | webpack从入门到精通</title>
    <meta name="description" content="讲解webpack相关知识点">
    
    
    <link rel="preload" href="/webpack-docs/assets/css/0.styles.d386d2e7.css" as="style"><link rel="preload" href="/webpack-docs/assets/js/app.aca2803f.js" as="script"><link rel="preload" href="/webpack-docs/assets/js/20.cc9a5cbb.js" as="script"><link rel="prefetch" href="/webpack-docs/assets/js/10.badb5ac2.js"><link rel="prefetch" href="/webpack-docs/assets/js/11.b66f8d28.js"><link rel="prefetch" href="/webpack-docs/assets/js/12.1d9b45c9.js"><link rel="prefetch" href="/webpack-docs/assets/js/13.caa9d9f6.js"><link rel="prefetch" href="/webpack-docs/assets/js/14.0ccd2cf5.js"><link rel="prefetch" href="/webpack-docs/assets/js/15.50832eec.js"><link rel="prefetch" href="/webpack-docs/assets/js/16.3e0d0619.js"><link rel="prefetch" href="/webpack-docs/assets/js/17.f1ed90b1.js"><link rel="prefetch" href="/webpack-docs/assets/js/18.add20acc.js"><link rel="prefetch" href="/webpack-docs/assets/js/19.37824718.js"><link rel="prefetch" href="/webpack-docs/assets/js/2.4d5841c8.js"><link rel="prefetch" href="/webpack-docs/assets/js/21.24f11d93.js"><link rel="prefetch" href="/webpack-docs/assets/js/22.e2970bdd.js"><link rel="prefetch" href="/webpack-docs/assets/js/23.672d8e5c.js"><link rel="prefetch" href="/webpack-docs/assets/js/3.7fb57e9c.js"><link rel="prefetch" href="/webpack-docs/assets/js/4.9dfeaf02.js"><link rel="prefetch" href="/webpack-docs/assets/js/5.8ea0d1b0.js"><link rel="prefetch" href="/webpack-docs/assets/js/6.3ca59bf8.js"><link rel="prefetch" href="/webpack-docs/assets/js/7.feaaa69d.js"><link rel="prefetch" href="/webpack-docs/assets/js/8.f03cdd3d.js"><link rel="prefetch" href="/webpack-docs/assets/js/9.630215ae.js">
    <link rel="stylesheet" href="/webpack-docs/assets/css/0.styles.d386d2e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/webpack-docs/" class="home-link router-link-active"><!----> <span class="site-name">webpack从入门到精通</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/webpack-docs/" class="nav-link">主页</a></div><div class="nav-item"><a href="/webpack-docs/page/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Michael-lzg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/user/5b52fd38f265da0f4c6fbd72/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/webpack-docs/" class="nav-link">主页</a></div><div class="nav-item"><a href="/webpack-docs/page/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Michael-lzg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/user/5b52fd38f265da0f4c6fbd72/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>webpack前世今生</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/webpack-docs/page/fonted/前端模块化.html" class="sidebar-link">前端模块化</a></li><li><a href="/webpack-docs/page/fonted/glup.html" class="sidebar-link">webpack 与 glup</a></li><li><a href="/webpack-docs/page/fonted/webpack4.0.html" class="sidebar-link">webpack 4.0</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>webpack基础篇</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/webpack-docs/page/base/entry.html" class="sidebar-link">entry和output</a></li><li><a href="/webpack-docs/page/base/loader.html" class="sidebar-link">Loader</a></li><li><a href="/webpack-docs/page/base/plugin.html" class="sidebar-link">Plugin</a></li><li><a href="/webpack-docs/page/base/webpack-dev-derver.html" class="sidebar-link">webpack-dev-derver</a></li><li><a href="/webpack-docs/page/base/sourcemap.html" class="sidebar-link">sourceMap</a></li><li><a href="/webpack-docs/page/base/externals.html" class="sidebar-link">externals</a></li><li><a href="/webpack-docs/page/base/optimization.html" class="sidebar-link">optimization</a></li><li><a href="/webpack-docs/page/base/babel.html" class="sidebar-link">babel 指南</a></li><li><a href="/webpack-docs/page/base/hash.html" class="sidebar-link">文件 hash</a></li><li><a href="/webpack-docs/page/base/知识问答.html" class="active sidebar-link">webpack 知识问答</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack-docs/page/base/知识问答.html#webpack-的执行流程" class="sidebar-link">webpack 的执行流程</a></li><li class="sidebar-sub-header"><a href="/webpack-docs/page/base/知识问答.html#es6-转化为-es5-的原理" class="sidebar-link">ES6 转化为 ES5 的原理</a></li><li class="sidebar-sub-header"><a href="/webpack-docs/page/base/知识问答.html#热更新的原理分析" class="sidebar-link">热更新的原理分析</a></li><li class="sidebar-sub-header"><a href="/webpack-docs/page/base/知识问答.html#解决-vendor-文件过大的问题" class="sidebar-link">解决 vendor 文件过大的问题</a></li></ul></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>webpack深入篇</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/webpack-docs/page/advanced/从零构建一个wbpack项目.html" class="sidebar-link">从零构建一个wbpack项目</a></li><li><a href="/webpack-docs/page/advanced/用webpack构建一个vue项目.html" class="sidebar-link">用webpack构建一个vue项目</a></li><li><a href="/webpack-docs/page/advanced/移动端开发模板.html" class="sidebar-link">vue-cli4+vant 开发模板</a></li><li><a href="/webpack-docs/page/advanced/webpack优化打包大全.html" class="sidebar-link">webpack优化打包大全</a></li><li><a href="/webpack-docs/page/advanced/webpack-chain.html" class="sidebar-link">webpack-chain</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="webpack-知识问答"><a href="#webpack-知识问答" aria-hidden="true" class="header-anchor">#</a> webpack 知识问答</h1> <h2 id="webpack-的执行流程"><a href="#webpack-的执行流程" aria-hidden="true" class="header-anchor">#</a> webpack 的执行流程</h2> <p>webpack从启动到结束会依次执行以下流程：</p> <ul><li>初始化：解析webpack配置参数，生产 Compiler 实例</li> <li>注册插件：调用插件的apply方法，给插件传入compiler实例的引用，插件通过compiler调用Webpack提供的API，让插件可以监听后续的所有事件节点。</li> <li>开始编译：读取入口文件</li> <li>解析文件：使用loader将文件解析成抽象语法树 AST</li> <li>生成依赖图谱：找出每个文件的依赖项（遍历）</li> <li>输出：根据转换好的代码，生成 chunk</li> <li>生成最后打包的文件</li></ul> <p>ps：由于 webpack 是根据依赖图动态加载所有的依赖项，所以，每个模块都可以明确表述自身的依赖，可以避免打包未使用的模块。</p> <h2 id="es6-转化为-es5-的原理"><a href="#es6-转化为-es5-的原理" aria-hidden="true" class="header-anchor">#</a> ES6 转化为 ES5 的原理</h2> <ul><li>解析：解析代码字符串，生成 AST；</li> <li>转换：按一定的规则转换、修改 AST；</li> <li>生成：将修改后的 AST 转换成普通代码。</li></ul> <h2 id="热更新的原理分析"><a href="#热更新的原理分析" aria-hidden="true" class="header-anchor">#</a> 热更新的原理分析</h2> <p>详情参考  https://zhuanlan.zhihu.com/p/30669007</p> <h4 id="_1-webpack-对文件系统进行-watch-打包到内存中"><a href="#_1-webpack-对文件系统进行-watch-打包到内存中" aria-hidden="true" class="header-anchor">#</a> 1. webpack 对文件系统进行 watch 打包到内存中</h4> <p>webpack-dev-middleware 调用 webpack 的 api 对文件系统 watch，当文件发生改变后，webpack 重新对文件进行编译打包，然后保存到内存中。</p> <p>webpack 将 bundle.js 文件打包到了内存中，不生成文件的原因就在于访问内存中的代码比访问文件系统中的文件更快，而且也减少了代码写入文件的开销。</p> <h4 id="_2-devserver-通知浏览器端文件发生改变"><a href="#_2-devserver-通知浏览器端文件发生改变" aria-hidden="true" class="header-anchor">#</a> 2. devServer 通知浏览器端文件发生改变</h4> <p>在启动 devServer 的时候，sockjs 在服务端和浏览器端建立了一个 webSocket 长连接，以便将 webpack 编译和打包的各个阶段状态告知浏览器，最关键的步骤还是 webpack-dev-server 调用 webpack api 监听 compile的 done 事件，当compile 完成后，webpack-dev-server通过 _sendStatus 方法将编译打包后的新模块 hash 值发送到浏览器端。</p> <h4 id="_3-webpack-dev-server-client-接收到服务端消息做出响应"><a href="#_3-webpack-dev-server-client-接收到服务端消息做出响应" aria-hidden="true" class="header-anchor">#</a> 3. webpack-dev-server/client 接收到服务端消息做出响应</h4> <p>webpack-dev-server 修改了webpack 配置中的 entry 属性，在里面添加了 webpack-dev-client 的代码，这样在最后的 bundle.js 文件中就会接收 websocket 消息的代码了。</p> <p>webpack-dev-server/client 当接收到 type 为 hash 消息后会将 hash 值暂存起来，当接收到 type 为 ok 的消息后对应用执行 reload 操作。在 reload 操作中，webpack-dev-server/client 会根据 hot 配置决定是刷新浏览器还是对代码进行热更新（HMR）。</p> <h4 id="_4-webpack-接收到最新-hash-值验证并请求模块代码"><a href="#_4-webpack-接收到最新-hash-值验证并请求模块代码" aria-hidden="true" class="header-anchor">#</a> 4.webpack 接收到最新 hash 值验证并请求模块代码</h4> <p>首先 webpack/hot/dev-server（以下简称 dev-server） 监听第三步 webpack-dev-server/client 发送的 webpackHotUpdate 消息，调用 webpack/lib/HotModuleReplacement.runtime（简称 HMR runtime）中的 check 方法，检测是否有新的更新。</p> <p>在 check 过程中会利用 webpack/lib/JsonpMainTemplate.runtime（简称 jsonp runtime）中的两个方法 hotDownloadManifest 和 hotDownloadUpdateChunk。<br>
hotDownloadManifest 是调用 AJAX 向服务端请求是否有更新的文件，如果有将发更新的文件列表返回浏览器端。该方法返回的是最新的 hash 值。</p> <p>hotDownloadUpdateChunk 是通过 jsonp 请求最新的模块代码，然后将代码返回给 HMR runtime，HMR runtime 会根据返回的新模块代码做进一步处理，可能是刷新页面，也可能是对模块进行热更新。该 方法返回的就是最新 hash 值对应的代码块。
最后将新的代码块返回给 HMR runtime，进行模块热更新。</p> <h4 id="_5-hotmodulereplacement-runtime-对模块进行热更新"><a href="#_5-hotmodulereplacement-runtime-对模块进行热更新" aria-hidden="true" class="header-anchor">#</a> 5. HotModuleReplacement.runtime 对模块进行热更新</h4> <p>这一步是整个模块热更新（HMR）的关键步骤，而且模块热更新都是发生在HMR runtime 中的 hotApply 方法中。</p> <p>模块热更新的错误处理，如果在热更新过程中出现错误，热更新将回退到刷新浏览器</p> <h4 id="_6-构建输出的⽂件"><a href="#_6-构建输出的⽂件" aria-hidden="true" class="header-anchor">#</a> 6. 构建输出的⽂件</h4> <h2 id="解决-vendor-文件过大的问题"><a href="#解决-vendor-文件过大的问题" aria-hidden="true" class="header-anchor">#</a> 解决 vendor 文件过大的问题</h2> <ol><li>CDN 方式引入资源
把不常改变的库放到 index.html 中，通过 cdn 引入</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/vue@2.5.2/dist/vue.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/vue-router@3.0.1/dist/vue-router.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/mint-ui@2.2.13/lib/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/element-ui@2.3.9/lib/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/axios@0.18.0/dist/axios.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>配置 webpack 的 externals 属性</p> <div class="language-js extra-class"><pre class="language-js"><code>externals<span class="token punctuation">:</span><span class="token punctuation">{</span>
<span class="token string">'vue'</span><span class="token punctuation">:</span><span class="token string">'Vue'</span><span class="token punctuation">,</span>
<span class="token string">'element-ui'</span><span class="token punctuation">:</span><span class="token string">'ELEMENT'</span><span class="token punctuation">,</span>
<span class="token string">'mint-ui'</span><span class="token punctuation">:</span><span class="token string">'MINT'</span><span class="token punctuation">,</span>
<span class="token string">'axios'</span><span class="token punctuation">:</span><span class="token string">'axios'</span><span class="token punctuation">,</span>
<span class="token string">'vue-router'</span><span class="token punctuation">:</span><span class="token string">'VueRouter'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>路由懒加载</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">'/index'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token punctuation">:</span> <span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/components/index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">'/about'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token punctuation">:</span> <span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/components/about'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/webpack-docs/assets/js/app.aca2803f.js" defer></script><script src="/webpack-docs/assets/js/20.cc9a5cbb.js" defer></script>
  </body>
</html>
