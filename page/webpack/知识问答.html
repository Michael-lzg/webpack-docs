<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack 知识问答 | webpack从入门到精通</title>
    <meta name="description" content="讲解webpack相关知识点">
    
    
    <link rel="preload" href="/webpack-docs/assets/css/0.styles.d386d2e7.css" as="style"><link rel="preload" href="/webpack-docs/assets/js/app.523ca243.js" as="script"><link rel="preload" href="/webpack-docs/assets/js/11.4231ba87.js" as="script"><link rel="prefetch" href="/webpack-docs/assets/js/10.a759a65e.js"><link rel="prefetch" href="/webpack-docs/assets/js/12.0d5f9ecf.js"><link rel="prefetch" href="/webpack-docs/assets/js/2.ffe410d0.js"><link rel="prefetch" href="/webpack-docs/assets/js/3.a9a8433f.js"><link rel="prefetch" href="/webpack-docs/assets/js/4.25c78323.js"><link rel="prefetch" href="/webpack-docs/assets/js/5.3323bb1b.js"><link rel="prefetch" href="/webpack-docs/assets/js/6.d46bfe17.js"><link rel="prefetch" href="/webpack-docs/assets/js/7.eecfade2.js"><link rel="prefetch" href="/webpack-docs/assets/js/8.ef513609.js"><link rel="prefetch" href="/webpack-docs/assets/js/9.da414fd4.js">
    <link rel="stylesheet" href="/webpack-docs/assets/css/0.styles.d386d2e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/webpack-docs/" class="home-link router-link-active"><!----> <span class="site-name">webpack从入门到精通</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/webpack-docs/" class="nav-link">主页</a></div><div class="nav-item"><a href="/webpack-docs/page/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Michael-lzg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/user/5b52fd38f265da0f4c6fbd72/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/webpack-docs/" class="nav-link">主页</a></div><div class="nav-item"><a href="/webpack-docs/page/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Michael-lzg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/user/5b52fd38f265da0f4c6fbd72/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>webpack专题</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/webpack-docs/page/webpack/基本配置.html" class="sidebar-link">webpack 基本配置</a></li><li><a href="/webpack-docs/page/webpack/知识问答.html" class="active sidebar-link">webpack 知识问答</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack-docs/page/webpack/知识问答.html#webpack4-0-带来的优化" class="sidebar-link">Webpack4.0 带来的优化</a></li><li class="sidebar-sub-header"><a href="/webpack-docs/page/webpack/知识问答.html#webpack-的执行流程" class="sidebar-link">webpack 的执行流程</a></li><li class="sidebar-sub-header"><a href="/webpack-docs/page/webpack/知识问答.html#es6-转化为-es5-的原理" class="sidebar-link">ES6 转化为 ES5 的原理</a></li><li class="sidebar-sub-header"><a href="/webpack-docs/page/webpack/知识问答.html#热更新的原理分析" class="sidebar-link">热更新的原理分析</a></li><li class="sidebar-sub-header"><a href="/webpack-docs/page/webpack/知识问答.html#loader-的执行顺序" class="sidebar-link">loader 的执行顺序</a></li><li class="sidebar-sub-header"><a href="/webpack-docs/page/webpack/知识问答.html#loader-和-plugin-的区别" class="sidebar-link">loader 和 plugin 的区别</a></li><li class="sidebar-sub-header"><a href="/webpack-docs/page/webpack/知识问答.html#⽂件哈希值" class="sidebar-link">⽂件哈希值</a></li><li class="sidebar-sub-header"><a href="/webpack-docs/page/webpack/知识问答.html#dllplugin优化" class="sidebar-link">Dllplugin优化</a></li><li class="sidebar-sub-header"><a href="/webpack-docs/page/webpack/知识问答.html#解决-vendor-文件过大的问题" class="sidebar-link">解决 vendor 文件过大的问题</a></li><li class="sidebar-sub-header"><a href="/webpack-docs/page/webpack/知识问答.html#source-map-生产环境怎么用" class="sidebar-link">source map 生产环境怎么用</a></li></ul></li><li><a href="/webpack-docs/page/webpack/对比glup.html" class="sidebar-link">webpack 与 glup</a></li><li><a href="/webpack-docs/page/webpack/搭建项目.html" class="sidebar-link">webpack4 搭建一个项目</a></li><li><a href="/webpack-docs/page/webpack/优化打包.html" class="sidebar-link">webpack 打包优化</a></li><li><a href="/webpack-docs/page/webpack/loader.html" class="sidebar-link">手写一个 loader</a></li><li><a href="/webpack-docs/page/webpack/babel.html" class="sidebar-link">babel 指南</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="webpack-知识问答"><a href="#webpack-知识问答" aria-hidden="true" class="header-anchor">#</a> webpack 知识问答</h1> <h2 id="webpack4-0-带来的优化"><a href="#webpack4-0-带来的优化" aria-hidden="true" class="header-anchor">#</a> Webpack4.0 带来的优化</h2> <p>Webpack4.0 的构建速度远远快于 Webpack3.0，官方也说升级之后，升级版本之后，构建时间可以降低 60% - 98% 左右。</p> <ul><li>v8 引擎带来的优化（for of 替代 forEach、Map 和 Set 替代 Object、includes 替代 indexOf）</li> <li>默认使用更快的 md4 hash 算法</li> <li>webpack AST 可以直接从 loader 传递给 AST，减少解析时间</li> <li>使用字符串方法替代正则表达式</li></ul> <h2 id="webpack-的执行流程"><a href="#webpack-的执行流程" aria-hidden="true" class="header-anchor">#</a> webpack 的执行流程</h2> <p>webpack从启动到结束会依次执行以下流程：</p> <ul><li>初始化：解析webpack配置参数，生产 Compiler 实例</li> <li>注册插件：调用插件的apply方法，给插件传入compiler实例的引用，插件通过compiler调用Webpack提供的API，让插件可以监听后续的所有事件节点。</li> <li>开始编译：读取入口文件</li> <li>解析文件：使用loader将文件解析成抽象语法树 AST</li> <li>生成依赖图谱：找出每个文件的依赖项（遍历）</li> <li>输出：根据转换好的代码，生成 chunk</li> <li>生成最后打包的文件</li></ul> <p>ps：由于 webpack 是根据依赖图动态加载所有的依赖项，所以，每个模块都可以明确表述自身的依赖，可以避免打包未使用的模块。</p> <h2 id="es6-转化为-es5-的原理"><a href="#es6-转化为-es5-的原理" aria-hidden="true" class="header-anchor">#</a> ES6 转化为 ES5 的原理</h2> <ul><li>解析：解析代码字符串，生成 AST；</li> <li>转换：按一定的规则转换、修改 AST；</li> <li>生成：将修改后的 AST 转换成普通代码。</li></ul> <h2 id="热更新的原理分析"><a href="#热更新的原理分析" aria-hidden="true" class="header-anchor">#</a> 热更新的原理分析</h2> <p>详情参考  https://zhuanlan.zhihu.com/p/30669007</p> <h4 id="_1-webpack-对文件系统进行-watch-打包到内存中"><a href="#_1-webpack-对文件系统进行-watch-打包到内存中" aria-hidden="true" class="header-anchor">#</a> 1. webpack 对文件系统进行 watch 打包到内存中</h4> <p>webpack-dev-middleware 调用 webpack 的 api 对文件系统 watch，当文件发生改变后，webpack 重新对文件进行编译打包，然后保存到内存中。</p> <p>webpack 将 bundle.js 文件打包到了内存中，不生成文件的原因就在于访问内存中的代码比访问文件系统中的文件更快，而且也减少了代码写入文件的开销。</p> <h4 id="_2-devserver-通知浏览器端文件发生改变"><a href="#_2-devserver-通知浏览器端文件发生改变" aria-hidden="true" class="header-anchor">#</a> 2. devServer 通知浏览器端文件发生改变</h4> <p>在启动 devServer 的时候，sockjs 在服务端和浏览器端建立了一个 webSocket 长连接，以便将 webpack 编译和打包的各个阶段状态告知浏览器，最关键的步骤还是 webpack-dev-server 调用 webpack api 监听 compile的 done 事件，当compile 完成后，webpack-dev-server通过 _sendStatus 方法将编译打包后的新模块 hash 值发送到浏览器端。</p> <h4 id="_3-webpack-dev-server-client-接收到服务端消息做出响应"><a href="#_3-webpack-dev-server-client-接收到服务端消息做出响应" aria-hidden="true" class="header-anchor">#</a> 3. webpack-dev-server/client 接收到服务端消息做出响应</h4> <p>webpack-dev-server 修改了webpack 配置中的 entry 属性，在里面添加了 webpack-dev-client 的代码，这样在最后的 bundle.js 文件中就会接收 websocket 消息的代码了。</p> <p>webpack-dev-server/client 当接收到 type 为 hash 消息后会将 hash 值暂存起来，当接收到 type 为 ok 的消息后对应用执行 reload 操作。在 reload 操作中，webpack-dev-server/client 会根据 hot 配置决定是刷新浏览器还是对代码进行热更新（HMR）。</p> <h4 id="_4-webpack-接收到最新-hash-值验证并请求模块代码"><a href="#_4-webpack-接收到最新-hash-值验证并请求模块代码" aria-hidden="true" class="header-anchor">#</a> 4.webpack 接收到最新 hash 值验证并请求模块代码</h4> <p>首先 webpack/hot/dev-server（以下简称 dev-server） 监听第三步 webpack-dev-server/client 发送的 webpackHotUpdate 消息，调用 webpack/lib/HotModuleReplacement.runtime（简称 HMR runtime）中的 check 方法，检测是否有新的更新。</p> <p>在 check 过程中会利用 webpack/lib/JsonpMainTemplate.runtime（简称 jsonp runtime）中的两个方法 hotDownloadManifest 和 hotDownloadUpdateChunk。<br>
hotDownloadManifest 是调用 AJAX 向服务端请求是否有更新的文件，如果有将发更新的文件列表返回浏览器端。该方法返回的是最新的 hash 值。</p> <p>hotDownloadUpdateChunk 是通过 jsonp 请求最新的模块代码，然后将代码返回给 HMR runtime，HMR runtime 会根据返回的新模块代码做进一步处理，可能是刷新页面，也可能是对模块进行热更新。该 方法返回的就是最新 hash 值对应的代码块。
最后将新的代码块返回给 HMR runtime，进行模块热更新。</p> <h4 id="_5-hotmodulereplacement-runtime-对模块进行热更新"><a href="#_5-hotmodulereplacement-runtime-对模块进行热更新" aria-hidden="true" class="header-anchor">#</a> 5. HotModuleReplacement.runtime 对模块进行热更新</h4> <p>这一步是整个模块热更新（HMR）的关键步骤，而且模块热更新都是发生在HMR runtime 中的 hotApply 方法中。</p> <p>模块热更新的错误处理，如果在热更新过程中出现错误，热更新将回退到刷新浏览器</p> <h4 id="_6-构建输出的⽂件"><a href="#_6-构建输出的⽂件" aria-hidden="true" class="header-anchor">#</a> 6. 构建输出的⽂件</h4> <h2 id="loader-的执行顺序"><a href="#loader-的执行顺序" aria-hidden="true" class="header-anchor">#</a> loader 的执行顺序</h2> <p>函数组合通常有两种方式，一种是从左到右(类似 unix 的 pipe)，另外一种是从右到左(compose)。webpack 选择的是 compose 方式，从右到左依次执行 loader，每个 loader 是一个函数。</p> <p>webpack 里面的 compose 代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>fns</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fns<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">prevFn<span class="token punctuation">,</span> nextFn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token function">nextFn</span><span class="token punctuation">(</span><span class="token function">prevFn</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="loader-和-plugin-的区别"><a href="#loader-和-plugin-的区别" aria-hidden="true" class="header-anchor">#</a> loader 和 plugin 的区别</h2> <ul><li><p>loader，它是一个转换器，将 A 文件进行编译成 B 文件，比如：将 A.less 转换为 A.css，单纯的文件转换过程。webpack 自身只支持 js 和 json 这两种格式的文件，对于其他文件需要通过 loader 将其转换为 commonJS 规范的文件后，webpack 才能解析到</p></li> <li><p>plugin 是一个扩展器，它丰富了 webpack 本身，针对是 loader 结束后，webpack 打包的整个过程，它并不直接操作文件，而是基于事件机制工作，会监听 webpack 打包过程中的某些节点，执行广泛的任务。</p></li></ul> <h2 id="⽂件哈希值"><a href="#⽂件哈希值" aria-hidden="true" class="header-anchor">#</a> ⽂件哈希值</h2> <p>⽂件哈希值就是打包后输出的⽂件名的后缀</p> <h4 id="⽂件哈希值如何⽣成"><a href="#⽂件哈希值如何⽣成" aria-hidden="true" class="header-anchor">#</a> ⽂件哈希值如何⽣成</h4> <ul><li>Hash：和整个项⽬的构建相关，只要项⽬⽂件有修改，整个项⽬构建的 hash 值就会更改</li> <li>Chunkhash：和 webpack 打包的 chunk 有关，不同的 entry 会⽣成不同的 chunkhash 值</li> <li>Contenthash：根据⽂件内容来定义 hash ，⽂件内容不变，则 contenthash 不变</li></ul> <h4 id="js-的⽂件哈希设置"><a href="#js-的⽂件哈希设置" aria-hidden="true" class="header-anchor">#</a> JS 的⽂件哈希设置</h4> <p>设置 output 的 filename，使⽤ [chunkhash]</p> <div class="language-js extra-class"><pre class="language-js"><code>output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name][chunkhash:8].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/dist'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意: chunkhash 无法和热更新一起使用</p> <h4 id="css-的⽂件哈希设置"><a href="#css-的⽂件哈希设置" aria-hidden="true" class="header-anchor">#</a> CSS 的⽂件哈希设置</h4> <p>设置 MiniCssExtractPlugin 的 filename，使⽤ [contenthash]</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>
plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`[name][contenthash:8].css`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p>如果想把 css 提取出来，那么 style-loader 就不能用了，因为两个是互斥的，所以我们可以这样写:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token operator">-</span> <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
            <span class="token operator">+</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader
            <span class="token string">'css-loader'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token operator">-</span> <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
            <span class="token operator">+</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader
            <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
            <span class="token string">'less-loader'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="图片-字体文件哈希设置"><a href="#图片-字体文件哈希设置" aria-hidden="true" class="header-anchor">#</a> 图片&amp;字体文件哈希设置</h4> <p>代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
     <span class="token punctuation">{</span>
       test<span class="token punctuation">:</span> <span class="token regex">/\.(png|svg|jpg|gif)$/</span><span class="token punctuation">,</span>
       use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> 'file<span class="token operator">-</span>loader’<span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
             name<span class="token punctuation">:</span> <span class="token string">'img/[name][hash:8].[ext] '</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">]</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="dllplugin优化"><a href="#dllplugin优化" aria-hidden="true" class="header-anchor">#</a> Dllplugin优化</h2> <p>在用 Webpack 打包的时候，对于一些不经常更新的第三方库，比如 react，lodash，vue 我们希望能和自己的代码分离开，Webpack 社区有两种方案：</p> <ul><li>CommonsChunkPlugin</li> <li>DLLPlugin</li></ul> <p>对于 CommonsChunkPlugin，webpack 每次打包实际还是需要去处理这些第三方库，只是打包完之后，能把第三方库和我们自己的代码分开。而 DLLPlugin 则是能把第三方代码完全分离开，即每次只打包项目自身的代码。</p> <h4 id="解决方法"><a href="#解决方法" aria-hidden="true" class="header-anchor">#</a> 解决方法</h4> <p>1、在build下创建 webpack.dll.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    vendor<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">'vue-router'</span><span class="token punctuation">,</span>
      <span class="token string">'vuex'</span><span class="token punctuation">,</span>
      <span class="token string">'vue/dist/vue.common.js'</span><span class="token punctuation">,</span>
      <span class="token string">'vue/dist/vue.js'</span><span class="token punctuation">,</span>
      <span class="token string">'vue-loader/lib/component-normalizer.js'</span><span class="token punctuation">,</span>
      <span class="token string">'vue'</span><span class="token punctuation">,</span>
      <span class="token string">'axios'</span><span class="token punctuation">,</span>
      <span class="token string">'echarts'</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
    library<span class="token punctuation">:</span> <span class="token string">'[name]_library'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./dist'</span><span class="token punctuation">,</span> <span class="token string">'[name]-manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'[name]_library'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 建议加上代码压缩插件，否则dll包会比较大。</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      compress<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        warnings<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2、在 webpack.prod.conf.js 的 plugin 后面加入配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    manifest<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dist/vendor-manifest.json'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>3、package.json文件中添加快捷命令(build:dll)</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack-dev-server --inline --progress --config build/webpack.dev.conf.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;npm run dev&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;lint&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;eslint --ext .js,.vue src&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;node build/build.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build:dll&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack --config build/webpack.dll.conf.js&quot;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>生产环境打包的时候先<code>npm run build:dll</code>命令会在打包目录下生成 <code>vendor-manifest.json</code> 文件与 vendor.dll.js 文件。然后<code>npm run build</code>生产其他文件。</p> <p>4、根目录下的入口 index.html 加入引用</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./vendor.dll.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="解决-vendor-文件过大的问题"><a href="#解决-vendor-文件过大的问题" aria-hidden="true" class="header-anchor">#</a> 解决 vendor 文件过大的问题</h2> <ol><li>CDN 方式引入资源
把不常改变的库放到 index.html 中，通过 cdn 引入</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/vue@2.5.2/dist/vue.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/vue-router@3.0.1/dist/vue-router.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/mint-ui@2.2.13/lib/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/element-ui@2.3.9/lib/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/axios@0.18.0/dist/axios.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>配置 webpack 的 externals 属性</p> <div class="language-js extra-class"><pre class="language-js"><code>externals<span class="token punctuation">:</span><span class="token punctuation">{</span>
<span class="token string">'vue'</span><span class="token punctuation">:</span><span class="token string">'Vue'</span><span class="token punctuation">,</span>
<span class="token string">'element-ui'</span><span class="token punctuation">:</span><span class="token string">'ELEMENT'</span><span class="token punctuation">,</span>
<span class="token string">'mint-ui'</span><span class="token punctuation">:</span><span class="token string">'MINT'</span><span class="token punctuation">,</span>
<span class="token string">'axios'</span><span class="token punctuation">:</span><span class="token string">'axios'</span><span class="token punctuation">,</span>
<span class="token string">'vue-router'</span><span class="token punctuation">:</span><span class="token string">'VueRouter'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>路由懒加载</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">'/index'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token punctuation">:</span> <span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/components/index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">'/about'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token punctuation">:</span> <span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/components/about'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="source-map-生产环境怎么用"><a href="#source-map-生产环境怎么用" aria-hidden="true" class="header-anchor">#</a> source map 生产环境怎么用</h2> <p>source map 是将编译、打包、压缩后的代码映射回源代码的过程。打包压缩后的代码不具备良好的可读性，想要调试源码就需要 soucre map。
map文件只要不打开开发者工具，浏览器是不会加载的。线上环境一般有三种处理方案：</p> <ul><li>hidden-source-map：借助第三方错误监控平台 Sentry 使用</li> <li>nosources-source-map：只会显示具体行数以及查看源代码的错误栈。安全性比 sourcemap 高</li> <li>sourcemap：通过 nginx 设置将 .map 文件只对白名单开放(公司内网)</li></ul> <p>注意：避免在生产中使用 inline- 和 eval-，因为它们会增加 bundle 体积大小，并降低整体性能。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/webpack-docs/assets/js/app.523ca243.js" defer></script><script src="/webpack-docs/assets/js/11.4231ba87.js" defer></script>
  </body>
</html>
