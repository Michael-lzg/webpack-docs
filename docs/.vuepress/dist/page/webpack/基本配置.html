<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack 基本配置 | webpack从入门到精通</title>
    <meta name="description" content="讲解webpack相关知识点">
    
    
    <link rel="preload" href="/assets/css/0.styles.1cb10e25.css" as="style"><link rel="preload" href="/assets/js/app.aa460e41.js" as="script"><link rel="preload" href="/assets/js/9.da414fd4.js" as="script"><link rel="prefetch" href="/assets/js/10.a759a65e.js"><link rel="prefetch" href="/assets/js/11.4231ba87.js"><link rel="prefetch" href="/assets/js/12.0d5f9ecf.js"><link rel="prefetch" href="/assets/js/2.ffe410d0.js"><link rel="prefetch" href="/assets/js/3.a9a8433f.js"><link rel="prefetch" href="/assets/js/4.25c78323.js"><link rel="prefetch" href="/assets/js/5.3323bb1b.js"><link rel="prefetch" href="/assets/js/6.d46bfe17.js"><link rel="prefetch" href="/assets/js/7.eecfade2.js"><link rel="prefetch" href="/assets/js/8.ef513609.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1cb10e25.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">webpack从入门到精通</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/page/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Michael-lzg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/user/5b52fd38f265da0f4c6fbd72/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/page/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Michael-lzg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/user/5b52fd38f265da0f4c6fbd72/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>webpack专题</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/page/webpack/基本配置.html" class="active sidebar-link">webpack 基本配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/page/webpack/基本配置.html#entry" class="sidebar-link">Entry</a></li><li class="sidebar-sub-header"><a href="/page/webpack/基本配置.html#output" class="sidebar-link">Output</a></li><li class="sidebar-sub-header"><a href="/page/webpack/基本配置.html#loader" class="sidebar-link">Loader</a></li><li class="sidebar-sub-header"><a href="/page/webpack/基本配置.html#plugin" class="sidebar-link">Plugin</a></li></ul></li><li><a href="/page/webpack/知识问答.html" class="sidebar-link">webpack 知识问答</a></li><li><a href="/page/webpack/对比glup.html" class="sidebar-link">webpack 与 glup</a></li><li><a href="/page/webpack/搭建项目.html" class="sidebar-link">webpack4 搭建一个项目</a></li><li><a href="/page/webpack/优化打包.html" class="sidebar-link">webpack 打包优化</a></li><li><a href="/page/webpack/loader.html" class="sidebar-link">手写一个 loader</a></li><li><a href="/page/webpack/babel.html" class="sidebar-link">babel 指南</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="webpack-基本配置"><a href="#webpack-基本配置" aria-hidden="true" class="header-anchor">#</a> webpack 基本配置</h1> <p>在很久很久以前，在我们前端还只是页面切图仔的年代，我们开发一个html页面，通常会遇到这些情况：</p> <ul><li>需要引入十几个css和js文件，而且因为他们彼此间有着依赖关系，所以引入的顺序还不能乱。</li> <li>传统的<code>html+css+js</code>开发方式不能不能很好地运用<code>less/scss</code>等css预处理器以及<code>ES6+</code>的高级语法。</li> <li>代码复用性差，可维护性差。</li></ul> <p>此时就需要一个处理这些问题的工具，webpack应运而生。</p> <p>webpack可以看做是模块打包工具：它将各种静态资源（比如：<code>javaScript</code> 文件，图片文件，<code>css</code>文件等）视为模块，它能够对这些模块进行解析优化和转换等操作，最后将它们打包在一起，打包后的文件可用于在浏览器中使用。</p> <h3 id="webpack的优点："><a href="#webpack的优点：" aria-hidden="true" class="header-anchor">#</a> webpack的优点：</h3> <ul><li>代码转换: <code>typeScript</code> 编译成 <code>javaScript</code>、<code>scss，less</code> 编译成 <code>css</code>.</li> <li>文件优化：压缩 <code>javaScript</code>、<code>css</code>、<code>html</code> 代码，压缩合并图片。</li> <li>代码分割：提取多个页面的公共代码、提取首屏不需要执行部分的代码让其异步加载。</li> <li>模块合并：在采用模块化的项目里会有很多个模块和文件，需要构建功能把模块分类合并成一个文件。</li> <li>自动刷新：监听本地源代码的变化，自动重新构建、刷新浏览器。</li> <li>扩展性强，插件机制完善。</li></ul> <h3 id="webpack打包过程："><a href="#webpack打包过程：" aria-hidden="true" class="header-anchor">#</a> webpack打包过程：</h3> <ol><li>利用babel完成代码转换,并生成单个文件的依赖</li> <li>从入口开始递归分析，并生成依赖图谱</li> <li>将各个引用模块打包为一个立即执行函数</li> <li>将最终的bundle文件写入bundle.js中</li></ol> <h3 id="webpack-的四大核心："><a href="#webpack-的四大核心：" aria-hidden="true" class="header-anchor">#</a> Webpack 的四大核心：</h3> <ul><li>entry：js 入口源文件</li> <li>output：生成文件</li> <li>loader：进行文件处理</li> <li>plugins：插件，比 loader 更强大，能使用更多 webpack 的 api</li></ul> <h2 id="entry"><a href="#entry" aria-hidden="true" class="header-anchor">#</a> Entry</h2> <p>webpack 应该使用哪个模块做为入口文件，来作为构建其内部依赖图的开始。进去入口起点后，webpack 会找出有哪些模块和库是入口起点（直接和间接）依赖的，每个依赖项随即被处理，最后输出到称之为 bundles 的文件中。</p> <p>单⼊⼝：entry 是⼀个字符串</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>多⼊⼝：entry 是⼀个对象</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    index<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    manager<span class="token punctuation">:</span> <span class="token string">'./src/manager.js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="output"><a href="#output" aria-hidden="true" class="header-anchor">#</a> Output</h2> <p>告诉 webpack 在哪里输出它所创建的 bundles，以及如何命名这些文件，这些都可以在webpack的配置文件中指定。</p> <p>单⼊⼝配置</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> 'bundle<span class="token punctuation">.</span>js’<span class="token punctuation">,</span>
        path<span class="token punctuation">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/dist'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>多⼊⼝配置</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">:</span> <span class="token string">'./src/app.js'</span><span class="token punctuation">,</span>
    search<span class="token punctuation">:</span> <span class="token string">'./src/search.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/dist'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过[name]占位符确保⽂件名称的唯⼀</p> <h2 id="loader"><a href="#loader" aria-hidden="true" class="header-anchor">#</a> Loader</h2> <p><code>loader</code> 让 <code>webpack</code> 能够去处理那些非 <code>javaScript</code> 文件（<code>webpack</code> 自身只理解 <code>javaScript</code>）。<code>loader</code> 可以将所有类型的文件转换为 <code>webpack</code> 能够处理的有效模块，然后你就可以利用 <code>webpack</code> 的打包能力，对它们进行处理。</p> <h3 id="loader的特点"><a href="#loader的特点" aria-hidden="true" class="header-anchor">#</a> loader的特点</h3> <ul><li>一个Loader 的职责是单一的，只需要完成一种转换</li> <li>一个Loader 其实就是一个Node.js 模块，这个模块需要导出一个函数</li> <li>loader 总是从右到左地被调用。</li></ul> <p>loader的使用方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 方法一</span>
<span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.jsx?$/</span><span class="token punctuation">,</span> <span class="token comment">//匹配规则</span>
  use<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span>
  <span class="token comment">// use: ['style-loader', 'css-loader'] 多个loader</span>
<span class="token punctuation">}</span>

<span class="token comment">// 方法二</span>
<span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.jsx?$/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token comment">//...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="常用的loader"><a href="#常用的loader" aria-hidden="true" class="header-anchor">#</a> 常用的loader</h3> <h4 id="处理样式"><a href="#处理样式" aria-hidden="true" class="header-anchor">#</a> 处理样式</h4> <ul><li><code>css-loader</code>: 加载.css 文件，</li> <li><code>style-loader</code>:使用 style 标签将 <code>css-loader</code> 内部样式注入到我们的 html 页面</li> <li><code>less-loader, sass-loader</code>: 解析css预处理器</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span> use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p><code>style-loader</code> 放在 <code>css-loader</code> 后面是因为 webpack 打包机制是按照数组从后往前的顺序将资源交个 loader 处理。</p> <h4 id="处理-js"><a href="#处理-js" aria-hidden="true" class="header-anchor">#</a> 处理 js</h4> <ul><li>让你能使用最新的js代码（ES6，ES7...）</li> <li>让你能使用基于js进行了拓展的语言，比如React的JSX；</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
      exclude<span class="token punctuation">:</span> <span class="token string">'/node_modules/'</span><span class="token punctuation">,</span>
      use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          cacheDirectory<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          presets<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span> <span class="token string">'env'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> modules<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
</code></pre></div><ul><li><code>exclude</code>，排除了目录 <code>node_modules</code>，可不编译 <code>node_modules</code> 目录中的模块，提高打包速度；</li> <li><code>babel-loader</code>，转译 ES6+;</li> <li><code>@babel/core</code>，babel 编译器核心模块；</li> <li><code>@babel/preset-env</code>，预置器，根据用户配置的目标环境自动添加需要的插件和补丁来编译 ES6+；</li> <li><code>cacheDirectory</code>，缓存机制，这里设为 true，在重复打包未改变的模块时防止二次编译，提高打包速度，指向 <code>node_modules/.cache/babel-loader</code>；</li> <li><code>presets</code> 的 modules 设置为 false，意思是禁止让 <code>@babel/preset-env</code> 将模块语句转换，让 <code>ES6 Module</code> 语法给 webpack 处理，若是为 true，会将 <code>ES6 Module</code> 模块转化为 <code>CommonJS</code> 形式，这将会导致 <code>tree-shaking</code> 特性失效；</li></ul> <h4 id="处理文件"><a href="#处理文件" aria-hidden="true" class="header-anchor">#</a> 处理文件</h4> <p>处理图片资源时，我们常用的两种loader是<code>file-loader</code>或者<code>url-loader</code>，两者的主要差异在于。<code>url-loader</code>可以设置图片大小限制，当图片超过限制时，其表现行为等同于<code>file-loader</code>，而当图片不超过限制时，则会将图片以<code>base64</code>的形式打包进css文件，以减少请求次数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.(png|jpe?g|gif|svg)(\?.*)?$/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    limit<span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">assetsPath</span><span class="token punctuation">(</span><span class="token string">'img/[name].[hash:7].[ext]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="处理-vue文件"><a href="#处理-vue文件" aria-hidden="true" class="header-anchor">#</a> 处理.vue文件</h4> <p><code>vue-loader</code> 是 <code>webpack</code> 的加载器模块，它使我们可以用 <code>.vue</code> 文件格式编写单文件组件。单文件组件文件有三个部分，即模板、脚本和样式。 <code>vue-loader</code> 模块允许 <code>webpack</code> 使用单独的加载器模块（例如 <code>sass 或 scss 加载器</code>）提取和处理每个部分。该设置使我们可以使用 <code>.vue</code> 文件无缝编写程序。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.vue$/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'vue-loader'</span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> vueLoaderConfig
<span class="token punctuation">}</span>
</code></pre></div><h3 id="开发一个loader"><a href="#开发一个loader" aria-hidden="true" class="header-anchor">#</a> 开发一个loader</h3> <p>需求：手写一个 <code>loader</code>，将 <code>'kobe'</code> 转换成 <code>'Black Mamba'</code>。当然大家可以根据自己的需求进行设计。这里只是讲解方法。</p> <h4 id="_1、编写-loader"><a href="#_1、编写-loader" aria-hidden="true" class="header-anchor">#</a> 1、编写 loader</h4> <p>在根目录下，新建目录 <code>kobe-loader</code> 作为我们编写 <code>loader</code> 的名称，执行 <code>npm init -y</code> 命令，新建一个模块化项目，然后新建 <code>index.js</code> 文件，相关源码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> content <span class="token operator">&amp;&amp;</span> content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/kobe/gi</span><span class="token punctuation">,</span> <span class="token string">'Black Mamba'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2、注册模块"><a href="#_2、注册模块" aria-hidden="true" class="header-anchor">#</a> 2、注册模块</h4> <p>正常我们安装的 <code>loader</code> 是从 <code>npm</code> 下载安装，但是我们可以在 <code>kobe-loader</code> 目录底下使用 <code>npm link</code> 做到在不发布模块的情况下，将本地的一个正在开发的模块的源码链接到项目的 <code>node_modules</code> 目录下，让项目可以直接使用本地的 <code>npm</code> 模块。</p> <div class="language- extra-class"><pre class="language-text"><code>npm link
</code></pre></div><p>然后在项目根目录执行以下命令，将注册到全局的本地 <code>npm</code> 模块链接到项目的 <code>node_modules</code> 下</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm link kobe-loader
</code></pre></div><p>注册成功后，我们可以在 <code>node_modules</code> 目录下能查找到对应的 <code>loader</code>。</p> <h4 id="_3、在-webpack-中配置-loader"><a href="#_3、在-webpack-中配置-loader" aria-hidden="true" class="header-anchor">#</a> 3、在 webpack 中配置 loader</h4> <p>在 <code>webpack.base.conf.js</code> 加上如下配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span><span class="token regex">/\.js/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'kobe-loader'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此时，我们在所有 js 文件下书写的 <code>'kobe'</code> 就全部替换成 <code>'Black Mamba'</code>了。</p> <h4 id="_4、配置参数"><a href="#_4、配置参数" aria-hidden="true" class="header-anchor">#</a> 4、配置参数</h4> <p>上面我们是写死的替换文案，假如我想通过配置项来改变，可以在 loader 中做以下调整</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// custom-loader/index.js</span>
<span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> content <span class="token operator">&amp;&amp;</span> content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/kobe/gi</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// webpack.base.conf.js</span>
<span class="token punctuation">{</span>
  test<span class="token punctuation">:</span><span class="token regex">/\.js/</span><span class="token punctuation">,</span>
  use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span> <span class="token string">'kobe-loader'</span><span class="token punctuation">,</span>
    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'kobe'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="plugin"><a href="#plugin" aria-hidden="true" class="header-anchor">#</a> Plugin</h2> <p>专注处理 webpack 在编译过程中的某个特定的任务的功能模块，可以称为插件。</p> <h3 id="plugin-的特点"><a href="#plugin-的特点" aria-hidden="true" class="header-anchor">#</a> Plugin 的特点</h3> <ul><li>是一个独立的模块</li> <li>模块对外暴露一个 js 函数</li> <li>函数的原型 <code>(prototype)</code> 上定义了一个注入 <code>compiler</code> 对象的 <code>apply</code>方法 <code>apply</code> 函数中需要有通过 <code>compiler</code> 对象挂载的 <code>webpack</code> 事件钩子，钩子的回调中能拿到当前编译的 <code>compilation</code> 对象，如果是异步编译插件的话可以拿到回调 <code>callback</code></li> <li>完成自定义子编译流程并处理 <code>complition</code> 对象的内部数据</li> <li>如果异步编译插件的话，数据处理完成后执行 <code>callback</code> 回调。</li></ul> <h3 id="常用plugin"><a href="#常用plugin" aria-hidden="true" class="header-anchor">#</a> 常用Plugin</h3> <ul><li><p><code>HotModuleReplacementPlugin</code> 代码热替换。因为 <code>Hot-Module-Replacement</code> 的热更新是依赖于 <code>webpack-dev-server</code>，后者是在打包文件改变时更新打包文件或者 reload 刷新整个页面，<code>HRM</code> 是只更新修改的部分。</p></li> <li><p><code>HtmlWebpackPlugin</code>, 生成 html 文件。将 webpack 中<code>entry</code>配置的相关入口 chunk 和 <code>extract-text-webpack-plugin</code>抽取的 css 样式 插入到该插件提供的<code>template</code>或者<code>templateContent</code>配置项指定的内容基础上生成一个 html 文件，具体插入方式是将样式<code>link</code>插入到<code>head</code>元素中，<code>script</code>插入到<code>head</code>或者<code>body</code>中。</p></li> <li><p><code>ExtractTextPlugin</code>, 将 css 成生文件，而非内联 。该插件的主要是为了抽离 css 样式,防止将样式打包在 js 中引起页面样式加载错乱的现象。</p></li> <li><p><code>NoErrorsPlugin</code>报错但不退出 webpack 进程</p></li> <li><p><code>UglifyJsPlugin</code>，代码丑化，开发过程中不建议打开。 <code>uglifyJsPlugin</code> 用来对 js 文件进行压缩，从而减小 js 文件的大小，加速 load 速度。<code>uglifyJsPlugin</code> 会拖慢 webpack 的编译速度，所有建议在开发简单将其关闭，部署的时候再将其打开。多个 html 共用一个 js 文件(chunk)，可用 <code>CommonsChunkPlugin</code></p></li> <li><p><code>purifycss-webpack</code>  。打包编译时，可剔除页面和 js 中未被使用的 css，这样使用第三方的类库时，只加载被使用的类，大大减小 css 体积</p></li> <li><p><code>optimize-css-assets-webpack-plugin</code>   压缩 css，优化 css 结构，利于网页加载和渲染</p></li> <li><p><code>webpack-parallel-uglify-plugin</code>   可以并行运行 UglifyJS 插件，这可以有效减少构建时间</p></li></ul> <h4 id="开发一个插件"><a href="#开发一个插件" aria-hidden="true" class="header-anchor">#</a> 开发一个插件</h4> <p>举个例子</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 1、BasicPlugin.js 文件（独立模块）</span>
 <span class="token comment">// 2、模块对外暴露的 js 函数</span>
 <span class="token keyword">class</span> <span class="token class-name">BasicPlugin</span><span class="token punctuation">{</span> 
     <span class="token comment">//在构造函数中获取用户为该插件传入的配置</span>
     <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">pluginOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> pluginOptions<span class="token punctuation">;</span>
     <span class="token punctuation">}</span> 
     <span class="token comment">//3、原型定义一个 apply 函数，并注入了 compiler 对象</span>
     <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
         <span class="token comment">//4、挂载 webpack 事件钩子（这里挂载的是 emit 事件）</span>
         compiler<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'emit'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token comment">// ... 内部进行自定义的编译操作</span>
             <span class="token comment">// 5、操作 compilation 对象的内部数据</span>
             console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>compilation<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">// 6、执行 callback 回调</span>
             <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span> 
 <span class="token comment">// 7、暴露 js 函数</span>
 module<span class="token punctuation">.</span>exports <span class="token operator">=</span> BasicPlugin<span class="token punctuation">;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.aa460e41.js" defer></script><script src="/assets/js/9.da414fd4.js" defer></script>
  </body>
</html>
